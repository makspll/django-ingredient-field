jobs: 
  build:
    docker: 
      - image: circleci/python:3.8
    steps: 
      - checkout 
      - run: 
          name: download dependencies
          command: |
              python3 -m venv venv
              . venv/bin/activate
              pip install -r requirements_dev.txt
      - run: 
          name: init .pypirc
          command: |
              echo -e "[pypi]" >> ~/.pypirc
              echo -e "username = $PYPI_USERNAME" >> ~/.pypirc
              echo -e "password = $PYPI_PASSWORD" >> ~/.pypirc
      - run: 
          name: upload to test pypi repository
          command: |
              . venv/bin/activate
              python3 django-ingredient-field/setup.py sdist
              twine upload --repository testpypi dist/*
workflows:
  version: 2
  build_and_test:
    jobs:
     - build